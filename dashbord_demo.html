<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>运营仪表盘</title>
    
    <!-- 引用 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    
    <!-- 引用 Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <!-- 引用 ApexCharts 图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        .kpi-card {
            transition: all 0.3s ease-in-out;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-slate-900">运营仪表盘</h1>
            <p class="text-lg text-slate-600 mt-1" id="dashboard-date">2025年8月12日, 星期二</p>
        </header>

        <main>
            <!-- 1. 核心KPI卡片 -->
            <section id="kpi-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- 卡片将由JS动态生成 -->
            </section>

            <!-- 2. 主内容区 -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- 左侧：收入趋势图 -->
                <section class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm kpi-card">
                    <h2 class="text-xl font-bold mb-4">月度管理费收入趋势</h2>
                    <div id="revenue-chart"></div>
                </section>

                <!-- 右侧：待办事项 -->
                <aside class="lg:col-span-1 space-y-8">
                    
                    <!-- 即将到期合同 -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm kpi-card">
                        <h3 class="text-lg font-bold mb-4">即将到期合同 (<span id="expiring-count">0</span>)</h3>
                        <div class="max-h-60 overflow-y-auto pr-2">
                            <ul id="expiring-contracts-list" class="space-y-3">
                                <!-- JS动态生成 -->
                            </ul>
                        </div>
                    </div>

                    <!-- 本月待收管理费 -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm kpi-card">
                        <h3 class="text-lg font-bold mb-4">本月待收管理费</h3>
                        <div class="max-h-60 overflow-y-auto pr-2">
                            <ul id="pending-payments-list" class="space-y-3">
                                <!-- JS动态生成 -->
                            </ul>
                        </div>
                    </div>

                    <!-- 本月待付薪酬 -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm kpi-card">
                        <h3 class="text-lg font-bold mb-4">本月待付员工薪酬</h3>
                        <div class="max-h-60 overflow-y-auto pr-2">
                            <ul id="pending-payouts-list" class="space-y-3">
                                <!-- JS动态生成 -->
                            </ul>
                        </div>
                    </div>

                </aside>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        
        // --- 模拟数据 (已按新需求更新) ---
        const mockData = {
            kpis: [
                { id: 'projected_revenue', title: '预计年度收入', value: '1,350,000', icon: 'trending_up', color: 'indigo' },
                { id: 'management_fee', title: '年度管理费 (已收/应收)', value: '850,000', total: '1,200,000', icon: 'account_balance_wallet', color: 'emerald' },
                { id: 'active_customers', title: '活跃客户数', value: '88', icon: 'groups', color: 'sky' },
                { id: 'active_employees', title: '在户员工数', value: '95', icon: 'badge', color: 'amber' }
            ],
            revenue_chart: {
                series: [{ name: '管理费收入', data: [180000, 250000, 220000, 310000, 280000, 458000] }],
                categories: ['三月', '四月', '五月', '六月', '七月', '八月']
            },
            expiring_contracts: [
                { customer: '张三', employee: '王阿姨', type: '育儿嫂', expires_in: 8, due_date: '2025-08-20' },
                { customer: '李四', employee: '赵阿姨', type: '月嫂', expires_in: 15, due_date: '2025-08-27' },
                { customer: '王五', employee: '钱阿姨', type: '育儿嫂', expires_in: 28, due_date: '2025-09-09' },
            ],
            pending_payments: [
                { customer: '周七', type: '月嫂', amount: '3,500.00' },
                { customer: '吴八', type: '育儿嫂', amount: '1,280.00' },
            ],
            pending_payouts: [
                { employee: '孙阿姨', type: '月嫂', amount: '16,800.00' },
                { employee: '郑阿姨', type: '育儿嫂', amount: '9,500.00' },
            ]
        };

        // --- 渲染函数 ---

        // 1. 渲染KPI卡片 (已更新)
        const kpiContainer = document.getElementById('kpi-cards');
        mockData.kpis.forEach(kpi => {
            const colorClasses = {
                indigo: { bg: 'bg-indigo-100', text: 'text-indigo-600' },
                emerald: { bg: 'bg-emerald-100', text: 'text-emerald-600' },
                amber: { bg: 'bg-amber-100', text: 'text-amber-600' },
                sky: { bg: 'bg-sky-100', text: 'text-sky-600' },
            };
            const colors = colorClasses[kpi.color] || colorClasses.indigo;
            const card = document.createElement('div');
            card.className = 'kpi-card bg-white p-6 rounded-2xl shadow-sm flex items-center';
            
            let valueHtml;
            if (kpi.id === 'management_fee') {
                valueHtml = `
                    <p class="text-3xl font-bold text-slate-900">¥${kpi.value}</p>
                    <p class="text-sm text-slate-500 font-medium mt-1">/ ¥${kpi.total}</p>
                `;
            } else {
                valueHtml = `
                    <p class="text-3xl font-bold text-slate-900">
                        ${kpi.id === 'projected_revenue' ? '¥' : ''}${kpi.value}
                    </p>
                `;
            }

            card.innerHTML = `
                <div class="p-4 ${colors.bg} rounded-full">
                    <span class="material-icons-outlined text-3xl ${colors.text}">${kpi.icon}</span>
                </div>
                <div class="ml-5">
                    <p class="text-sm text-slate-500 font-medium">${kpi.title}</p>
                    <div class="flex items-baseline space-x-2">
                        ${valueHtml}
                    </div>
                </div>
            `;
            kpiContainer.appendChild(card);
        });

        // 2. 渲染收入图表
        const chartOptions = {
            chart: {
                type: 'bar',
                height: 350,
                toolbar: { show: false },
            },
            series: mockData.revenue_chart.series,
            xaxis: {
                categories: mockData.revenue_chart.categories,
                labels: { style: { colors: '#64748b', fontFamily: 'Inter' } },
            },
            yaxis: {
                labels: {
                    style: { colors: '#64748b', fontFamily: 'Inter' },
                    formatter: (value) => `¥${(value / 1000).toFixed(0)}k`
                }
            },
            colors: ['#4f46e5'],
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: '55%',
                    borderRadius: 8,
                },
            },
            dataLabels: { enabled: false },
            stroke: { show: true, width: 2, colors: ['transparent'] },
            grid: { borderColor: '#e2e8f0', strokeDashArray: 4 },
            tooltip: {
                y: { formatter: (val) => `¥ ${val.toLocaleString()}` }
            }
        };
        const chart = new ApexCharts(document.querySelector("#revenue-chart"), chartOptions);
        chart.render();

        // 3. 渲染待办事项列表
        function renderList(containerId, items, templateFn) {
            const container = document.getElementById(containerId);
            if (items.length === 0) {
                container.innerHTML = `<li class="text-center text-slate-500 py-4">暂无事项</li>`;
                return;
            }
            container.innerHTML = items.map(templateFn).join('');
        }

        document.getElementById('expiring-count').textContent = mockData.expiring_contracts.length;

        renderList('expiring-contracts-list', mockData.expiring_contracts, item => `
            <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-100 transition-colors">
                <div>
                    <p class="font-semibold text-slate-800">${item.customer} / ${item.employee}</p>
                    <p class="text-sm text-slate-500">${item.type} · <span class="font-medium text-amber-600">${item.expires_in}天后到期</span> (${item.due_date})</p>
                </div>
                <a href="#" class="text-indigo-600 hover:text-indigo-800 text-sm font-semibold">续签</a>
            </li>
        `);

        renderList('pending-payments-list', mockData.pending_payments, item => `
            <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-100 transition-colors">
                <div>
                    <p class="font-semibold text-slate-800">${item.customer}</p>
                    <p class="text-sm text-slate-500">${item.type}</p>
                </div>
                <span class="font-bold text-red-600">¥${item.amount}</span>
            </li>
        `);

        renderList('pending-payouts-list', mockData.pending_payouts, item => `
            <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-100 transition-colors">
                <div>
                    <p class="font-semibold text-slate-800">${item.employee}</p>
                    <p class="text-sm text-slate-500">${item.type}</p>
                </div>
                <span class="font-bold text-emerald-600">¥${item.amount}</span>
            </li>
        `);
    });
    </script>

</body>
</html>