<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>服务合同</title>
    <style>
        body {
            font-family: 'SimSun', 'Songti SC', serif;
            font-size: 12px;
            line-height: 1.8;
        }
        .contract-content {
            /* 这个样式会导致Markdown的换行失效，所以我们把它注释掉 */
            /* white-space: pre-wrap; */ 
            word-wrap: break-word;
        }
        .party-details {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .party-details h3 {
            margin-top: 0;
            font-size: 14px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .party-details p {
            margin: 5px 0;
        }
        .signature-section {
            margin-top: 40px;
            page-break-inside: avoid; /* 避免签名部分分页 */
        }
        .signature-block {
            display: inline-block;
            width: 45%;
            margin-right: 5%;
            vertical-align: top;
        }
        .signature-block img {
            max-width: 150px;
            max-height: 75px;
            border-bottom: 1px solid #000;
            padding-bottom: 5px;
        }
        .signature-block p {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">{{ pdf_title }}</h1>

    <!-- 核心修正：添加甲方和乙方信息展示区 -->
    <div class="party-details">
        <h3>甲方 (客户) 信息</h3>
        {% if customer %}
            <p><strong>姓名:</strong> {{ customer.name }}</p>
            <p><strong>电话:</strong> {{ customer.phone_number }}</p>
            <p><strong>身份证号:</strong> {{ customer.id_card_number }}</p>
            <p><strong>地址:</strong> {{ customer.address }}</p>
        {% else %}
            <p>无客户信息</p>
        {% endif %}
    </div>

    <div class="party-details">
        <h3>乙方 (服务人员) 信息</h3>
        {% if employee %}
            <p><strong>姓名:</strong> {{ employee.name }}</p>
            <p><strong>电话:</strong> {{ employee.phone_number }}</p>
            <p><strong>身份证号:</strong> {{ employee.id_card_number }}</p>
            <p><strong>地址:</strong> {{ employee.address }}</p>
        {% else %}
            <p>无服务人员信息</p>
        {% endif %}
    </div>
    <!-- 修正结束 -->
    <div class="party-details">
        {% if contract.service_content %}
            <p><strong>服务内容:</strong> {{ contract.service_content or '未指定' }}</p>
        {% endif %}
        {% if contract.service_type %}
            <p><strong>服务方式:</strong> {{ contract.service_type or '未指定' }}</p>
        {% endif %}
            <p><strong>乙方劳务报酬:</strong> {{ "%.2f"|format(contract.employee_level|float) }} 元/月</p>
        {% if contract.security_deposit_paid > 0 %}
            <p><strong>保证金:</strong> {{ "%.2f"|format(contract.security_deposit_paid|float) }} 元</p>
        {% endif %}
        {% if contract.management_fee_amount >0 %}
            <p><strong>丙方管理费:</strong> {{ "%.2f"|format(contract.management_fee_amount|float) }} 元/月</p>
        {% endif %}
        <p><strong>介绍费:</strong> {{ "%.2f"|format(contract.introduction_fee|float) }} 元</p>
        {% if contract.type == 'maternity_nurse' %}
            <p><strong>合同开始时间:</strong> {{ contract.start_date.strftime('%Y-%m-%d') }} <span style="font-family: 'Microsoft YaHei'; color: #555; font-size: 10px;">(此处为用人时间，或预产期)</ span></p>
        {% else %}
            <p><strong>合同开始时间:</strong> {{ contract.start_date.strftime('%Y-%m-%d') }}</p>
        {% endif %}
        <p><strong>合同结束时间:</strong> {{ contract.end_date.strftime('%Y-%m-%d') }}</p>
    </div>

    <div class="contract-content">
        {{ main_content |safe }}</div>


    {% if attachment_content %}
        <h2>附件</h2>
        <div class="contract-content">{{ attachment_content|safe }}</div>
    {% endif %}

    <div class="signature-section">
        <div class="signature-block">
            <p>甲方 (客户):</p>
            {% if customer_signature %}
                <img src="{{ customer_signature }}" alt="客户签名">
            {% else %}
                <div style="height: 80px; border-bottom: 1px solid #000;">(未签名)</div>
            {% endif %}
        </div>
        <div class="signature-block">
            <p>乙方 (服务人员):</p>
            {% if employee_signature %}
                <img src="{{ employee_signature }}" alt="员工签名">
            {% else %}
                <div style="height: 80px; border-bottom: 1px solid #000;">(未签名)</div>
            {% endif %}
        </div>
    </div>
</body>
</html>