# 设计检查清单 (Design Checklist)

此清单用于在开发过程中和完成后，验证系统设计是否符合预期的“好品味”标准。

### 1. 数据库设计检查

| 检查项                                                              | 如何检查                                               | 检查结果 |
| ------------------------------------------------------------------- | ------------------------------------------------------ | -------- |
| `DynamicForm` 模型是否包含 `surveyjs_schema` (JSONB) 字段？         | 审查 `backend/models.py` 中的 `DynamicForm` 类定义。   | [ ] 通过 |
| `DynamicForm` 模型是否包含 `form_type` 和 `sync_mapping` (JSONB) 字段？ | 审查 `backend/models.py` 中的 `DynamicForm` 类定义。   | [ ] 通过 |
| `DynamicFormData` 模型是否包含 `data` (JSONB) 字段？                | 审查 `backend/models.py` 中的 `DynamicFormData` 类定义。 | [ ] 通过 |
| `DynamicFormData` 是否有到 `DynamicForm` 的外键关联？               | 检查 `DynamicFormData` 模型中的 `form_id` 字段和外键约束。 | [ ] 通过 |
| `DynamicFormData` 是否有到 `service_personnel` 或 `users` 的外键关联？ | 检查 `DynamicFormData` 模型中的关联字段。                | [ ] 通过 |
| 所有跨表写入操作是否都封装在数据库事务中？                          | 审查处理 `sync_mapping` 和反向关联的服务层代码。       | [ ] 通过 |

### 2. API 设计检查

| 检查项                                                                    | 如何检查                                                                                             | 检查结果 |
| ------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | -------- |
| `POST /api/form-data` 是否能根据 `sync_mapping` 正确更新核心表？            | 编写集成测试，提交一个带 `sync_mapping` 的表单，然后查询核心表（如 `service_personnel`）验证数据是否已更新。 | [ ] 通过 |
| `GET /api/form-data/{id}` 是否能正确聚合 `record_association` 的数据？      | 编写集成测试，查询一个包含关联字段的记录，检查响应中是否包含 `resolved_associations` 数据块。          | [ ] 通过 |
| API 是否实现了字段级的读取权限控制？                                      | 编写集成测试，使用不同角色（员工/HR）的Token调用 `GET` API，验证 HR 能看到私有字段，而员工不能。       | [ ] 通过 |
| API 是否实现了字段级的写入权限控制？                                      | 编写集成测试，使用员工角色 Token 尝试 `PATCH` 一个其无权修改的字段，验证请求是否被拒绝 (403 Forbidden)。 | [ ] 通过 |
| 反向关联逻辑是否能被正确触发并执行？                                      | 编写集成测试，创建一个“合同”并关联到“员工”，然后查询该员工记录，验证其 `current_contract_id` 是否已更新。 | [ ] 通过 |

### 3. 前端设计检查

| 检查项                                                              | 如何检查                                                               | 检查结果 |
| ------------------------------------------------------------------- | ---------------------------------------------------------------------- | -------- |
| `record_association` 自定义组件是否能从 API 获取并渲染一个可搜索的列表？ | 在 Storybook 或独立页面中对该组件进行单元/组件测试。                   | [ ] 通过 |
| 表单页面是否能根据传入的数据和用户权限，正确切换只读/编辑模式？       | 审查页面组件的 `useEffect` 和状态管理逻辑。                            | [ ] 通过 |
| 表单在编辑模式下，是否能正确加载已有数据？                          | 审查 `Survey.data` 属性是否被正确设置。                                | [ ] 通过 |

### 4. 迁移脚本检查

| 检查项                                                              | 如何检查                                                               | 检查结果 |
| ------------------------------------------------------------------- | ---------------------------------------------------------------------- | -------- |
| 转换器是否能正确处理所有已知的“金数据”字段类型？                    | 为转换器函数编写单元测试，提供各种类型的金数据字段作为输入，断言其输出是否为正确的 SurveyJS 格式。 | [ ] 通过 |
| 转换器是否能正确生成 `sync_mapping` 和 `record_association` 的元数据？ | 检查转换器的逻辑，确保它能识别特定的字段并生成相应的元数据配置。         | [ ] 通过 |
