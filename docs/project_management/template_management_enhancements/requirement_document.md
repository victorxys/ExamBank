# 需求文档: 合同模板管理功能优化

## 1. 概述

本次需求旨在对现有的合同模板管理功能进行重大优化和功能增强。核心目标是规范化模板的创建流程，增强列表的检索能力，并提供更灵活的版本对比功能。

## 2. 功能详述

### 2.1. 模板创建/编辑逻辑重构

1.  **模板命名的唯一性**:
    *   每个 `contract_type` (合同类型) 只能对应一个 `template_name` (模板名称)。从业务角度看，一个合同类型只有一套“制式模板”，所有后续操作都是在此基础上创建新版本。
    *   **创建流程**:
        *   当为某个还没有任何模板的 `contract_type` 创建第一个模板时，允许用户编辑模板名称。系统应提供一个默认名称，格式为 `{合同类型}制式模板` (例如，“育儿嫂合同制式模板”)。
        *   一旦某个 `contract_type` 有了第一个模板，后续所有基于此类型的操作（例如“另存为新版”）都不能再修改 `template_name`。模板名称将被锁定。
    *   **版本号**: 创建新版本时，版本号应自动 `+1`。

2.  **新增模板备注**:
    *   在 `ContractTemplate` 数据模型中增加一个 `remark` (或 `notes`) 字段，用于存储模板的备注信息。
    *   在创建或编辑模板时，用户可以填写此备注。此字段为可选项。

### 2.2. 列表页检索功能增强

1.  **模糊检索**:
    *   在合同模板列表页的顶部，增加一个搜索框。
    *   用户可以在搜索框中输入关键词，系统需对 `template_name` 和新增的 `remark` 字段进行模糊匹配 (LIKE查询)。

2.  **按合同类型筛选**:
    *   在列表页增加一个下拉筛选器，允许用户根据 `contract_type` 筛选模板列表。
    *   可以多选或单选进行筛选。

### 2.3. 跨版本对比功能

1.  **任意版本选择**:
    *   在合同模板列表的每一行前面，增加一个复选框 (Checkbox)。
    *   用户可以选择任意两个模板进行对比。

2.  **对比逻辑**:
    *   当用户勾选了**两个**模板，且这两个模板的 `contract_type` **相同**时，一个“对比”按钮会变为可用状态。
    *   如果勾选的模板数量不是两个，或者它们的 `contract_type` 不同，则“对比”按钮保持禁用。

3.  **差异显示**:
    *   点击“对比”按钮后，弹出一个 `diff` 模态框。
    *   该模态框会清晰地展示两个被选模板 `content` 字段之间的差异，类似于 `git diff` 的效果。

## 3. 影响范围

*   **数据库**: 需要修改 `contract_template` 表，增加 `remark` 字段。
*   **后端API**:
    *   `POST /api/contract_templates`: 创建逻辑需重构，以处理模板命名的唯一性规则。
    *   `GET /api/contract_templates`: 需要支持基于 `template_name`、`remark` 和 `contract_type` 的查询。
    *   需要新增一个 `POST /api/contract_templates/compare` 之类的端点，用于处理任意两个模板的对比请求。
*   **前端UI**:
    *   `ContractTemplateManager.jsx`: 列表页需要增加搜索框、筛选器、复选框和“对比”按钮。
    *   `CreateTemplateModal.jsx` (或类似组件): 创建模板的弹窗UI和逻辑需要重构，以适应新的命名规则和备注字段。
    *   需要一个 `Diff` 模态框来展示对比结果。
