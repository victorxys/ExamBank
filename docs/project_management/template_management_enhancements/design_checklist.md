# Design Checklist: 合同模板管理功能优化

此清单用于验证新功能的设计和实现是否符合预期。

## 1. 数据库与模型

-   [ ] **字段检查**:
    -   **检查方式**: 查看 `backend/models.py` 中的 `ContractTemplate` 模型。
    -   **检查点**: 是否已成功添加 `remark = db.Column(db.Text, nullable=True)` 字段。
    -   **检查结果**: [待填充]

-   [ ] **数据库迁移**:
    -   **检查方式**: 检查 `migrations/versions/` 目录下是否生成了新的迁移文件。
    -   **检查点**: 迁移文件中是否包含 `op.add_column('contract_template', sa.Column('remark', sa.Text(), nullable=True))`。
    -   **检查结果**: [待填充]

## 2. 后端API

-   [ ] **创建模板API (`POST /api/contract_templates`)**:
    -   **检查方式**: 使用API测试工具（如 Postman）调用此端点。
    -   **检查点 1 (首次创建)**: 当为某个 `contract_type` 首次创建模板时，传入自定义的 `template_name` 和 `remark`，API应返回201，并正确保存数据。
    -   **检查结果 1**: [待填充]
    -   **检查点 2 (非首次创建)**: 当为已存在模板的 `contract_type` 创建时，API应能正确处理（例如，遵循“版本+1”或特定的业务逻辑），并保存 `remark`。
    -   **检查结果 2**: [待填充]

-   [ ] **列表查询API (`GET /api/contract_templates`)**:
    -   **检查方式**: 使用浏览器或API工具访问此端点。
    -   **检查点 1 (返回字段)**: API返回的每个模板对象中是否都包含了 `remark` 字段。
    -   **检查结果 1**: [待填充]
    -   **检查点 2 (筛选功能)**: 访问 `?contract_type=nanny`，API是否只返回 `contract_type` 为 `nanny` 的模板。
    -   **检查结果 2**: [待填充]
    -   **检查点 3 (搜索功能)**: 假设某模板的 `remark` 为 "测试备注"，访问 `?search=备注`，API返回的结果中是否包含了该模板。
    -   **检查结果 3**: [待填充]

-   [ ] **跨版本对比API (`POST /api/contract_templates/compare`)**:
    -   **检查方式**: 使用API测试工具调用此端点。
    -   **检查点 1 (成功对比)**: 传入两个 `contract_type` 相同的模板ID，API应返回200，并包含两个模板的 `content` 和 `version`。
    -   **检查结果 1**: [待填充]
    -   **检查点 2 (失败对比)**: 传入两个 `contract_type` 不同的模板ID，API应返回4xx错误，并提示类型不匹配。
    -   **检查结果 2**: [待填充]

## 3. 前端UI与交互

-   [ ] **创建模板弹窗**:
    -   **检查方式**: 在UI上点击“创建模板”按钮。
    -   **检查点 1 (备注字段)**: 弹窗中是否存在“模板备注”输入框。
    -   **检查结果 1**: [待填充]
    -   **检查点 2 (名称锁定)**: 当选择一个已有模板的 `contract_type` 时，“模板名称”输入框是否被禁用。
    -   **检查结果 2**: [待填充]
    -   **检查点 3 (名称可编辑)**: 当选择一个没有任何模板的 `contract_type` 时，“模板名称”输入框是否变为可编辑，并显示正确的默认值。
    -   **检查结果 3**: [待填充]

-   [ ] **列表页功能**:
    -   **检查方式**: 查看合同模板列表页。
    -   **检查点 1 (UI元素)**: 页面上是否存在搜索框、类型筛选器、表格复选框和“对比已选”按钮。
    -   **检查结果 1**: [待填充]
    -   **检查点 2 (搜索/筛选交互)**: 在搜索框输入或选择筛选器后，列表内容是否实时更新并符合预期。
    -   **检查结果 2**: [待填充]
    -   **检查点 3 (对比按钮状态)**:
        -   不勾选/勾选1个/勾选3个时，按钮为禁用。
        -   勾选2个不同类型的模板时，按钮为禁用。
        -   勾选2个相同类型的模板时，按钮变为可用。
    -   **检查结果 3**: [待填充]

-   [ ] **跨版本对比弹窗**:
    -   **检查方式**: 在列表页勾选两个符合条件的模板，点击“对比已选”。
    -   **检查点**: 是否成功弹出一个 `diff` 视图，且视图中的内容正确对应所选的两个模板。
    -   **检查结果**: [待填充]
