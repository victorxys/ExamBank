# 需求文档: 员工管理功能 (V2-修订版)

## 1. 功能目标
开发一个"员工管理"模块，用于集中展示和管理员工（`ServicePersonnel`）的核心信息，并能以富含上下文信息的方式追溯其完整的薪资变更历史（`EmployeeSalaryHistory`）。

## 2. 核心功能
- **员工列表展示**: 系统应能以列表形式展示所有在 `service_personnel` 表中记录的员工。
- **员工详细信息**: 点击列表中的任一员工，可以查看其在 `service_personnel` 表中记录的所有基本信息。
- **薪资历史追溯 (富文本)**: 在员工详细信息页面，必须清晰地展示该员工的所有薪资变更记录。每一条记录都必须包含其关联的合同上下文信息，并明确标示薪资变化趋势。

## 3. 用户场景
- **场景**: HR或管理人员需要审查某位员工的薪资变动是否合理，并希望立刻看到该次变动对应的客户合同背景。
- **流程**:
    1. 管理员访问 "员工管理" 页面，看到员工列表（姓名、电话、在职状态）。
    2. 管理员点击目标员工。
    3. 系统展示该员工的详细资料（姓名、电话、身份证号、地址）。
    4. 在详细资料下方，是一个**薪资变更历史**表格，按**生效日期 (`effective_date`)** 降序排列。
    5. 表格的每一行代表一次薪资变更，包含以下列：
        - **客户名称**: 关联该次变更的合同上的客户名。
        - **合同周期**: 关联合同的开始及结束日期。
        - **上户地址**: 该客户的地址。
        - **原月薪**: 本次变更前的基本薪资。
        - **变更后月薪**: 本次变更后的基本薪资 (`base_salary`)。
        - **薪资变化**:
            - 若薪资上涨，显示**绿色箭头 (↑)**。
            - 若薪资下降，显示**红色箭头 (↓)**。
            - 若无变化或为首次记录，不显示箭头。
        - **生效日期**: `effective_date`。
        - **合同备注**: 关联合同中的 `notes` 字段。

## 4. 数据需求 (基于 `models.py`)
- **员工基本信息**:
    - **来源表**: `service_personnel`
    - **关键字段**: `id`, `name`, `phone_number`, `id_card_number`, `address`, `is_active`。
- **员工薪资变更历史**:
    - **来源表**: `employee_salary_history`
    - **关键字段**: `id`, `employee_id`, `contract_id`, `effective_date`, `base_salary`。
- **关联合同信息**:
    - **来源表**: `contracts` (`BaseContract`)
    - **关联方式**: `EmployeeSalaryHistory.contract_id` -> `BaseContract.id`
    - **关键字段**: `customer_name`, `start_date`, `end_date`, `notes`, `customer_id`。
- **关联客户信息**:
    - **来源表**: `customer`
    - **关联方式**: `BaseContract.customer_id` -> `Customer.id`
    - **关键字段**: `address`。

## 5. 非功能性需求
- **数据准确性**: 所有展示数据必须与数据库源头保持一致。薪资的“变更前/后”对比必须计算准确。
- **性能**: API在进行多表联合查询时，必须保证性能，避免N+1查询问题。
- **界面清晰度**: 薪资变化箭头必须颜色分明，易于辨识。
