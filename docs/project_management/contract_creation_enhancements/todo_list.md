# Todo List: 合同创建与签署流程优化

## 后端 (Backend)

-   [ ] **API 修改**: 增强员工搜索API (`/api/users/search`)。
    -   [ ] 在SQL查询中加入逻辑，获取每个员工最新的 `base_salary`。
    -   [ ] 确认查询性能，避免N+1问题。
    -   [ ] 在API的返回数据中为每个员工对象添加 `latest_salary` 字段。
-   [ ] **API 新建**: 创建一个新的API接口用于处理客户签署时提交的个人信息。
    -   [ ] 设计接口路由和请求体结构 (e.g., `POST /api/contracts/{token}/sign_and_update`)。
    -   [ ] 实现业务逻辑：根据 `token` 找到合同和关联的客户。
    -   [ ] 实现安全更新逻辑：只更新客户表中原先为空的字段（身份证、地址等）。
    -   [ ] 在同一个事务中，完成客户信息更新和合同签名状态变更。

## 前端 (Frontend)

-   [ ] **数据填充**: 修改合同创建页面 (`CreateFormalContractModal.jsx`, `CreateVirtualContractModal.jsx`)。
    -   [ ] 修改 `Autocomplete` 组件的 `onChange` 事件处理器。
    -   [ ] 当选中一个客户或员工时，从其对象中获取身份证、地址、薪酬等信息。
    -   [ ] 使用 `form.setFieldsValue` 或类似方法，将获取到的信息填充到对应的表单输入框中。
-   [ ] **客户信息补填**: 修改合同签署页面。
    -   [ ] 在页面加载时，增加一个逻辑判断：如果合同数据表明客户信息不完整，则显示一个信息补填表单。
    -   [ ] 创建这个表单组件，包含身份证、地址等输入框。
    -   [ ] 修改“确认签署”按钮的点击事件。
    -   [ ] 在提交签名数据时，一并将在表单中填写的客户信息包含进去，发送给新的后端API。

## 测试 (Testing)

-   [ ] **后端单元测试**:
    -   [ ] 为员工搜索API编写测试，验证返回结果中是否正确包含了 `latest_salary`。
    -   [ ] 为客户信息更新API编写测试，验证其能否正确、安全地更新客户资料。
-   [ ] **前端组件测试**:
    -   [ ] 验证自动填充功能是否按预期工作。
-   [ ] **端到端测试**:
    -   [ ] 模拟完整流程：创建合同时客户信息留空 -> 客户打开链接 -> 填写信息并签名 -> 验证后台客户数据是否已更新。
