## 替班管理费功能 - 验收清单 (Checklist)

**版本:** 2.2
**日期:** 2025年10月21日
**目的:** 用于验证“替班管理费”功能是否按 `01_requirements.md` (版本 2.0) 的要求正确实现。

---

### 场景一：为已结束或已终止的合同添加替班

- [ ] **检查项 1.1:** 为一个**已结束**（自然到期）或**已终止**（人工终止）的合同，添加一笔**完全在此合同最终有效日期之后**的替班记录。
  - **预期结果:** 对应的 `SubstituteRecord` 记录中的 `substitute_management_fee` 字段被更新为一个大于0的数值。

- [ ] **检查项 1.2:** 验证检查项 1.1 中生成的费用是否正确。
  - **预期结果:** 费用的计算所依据的计费天数，应等于该笔替班的**总天数**。

- [ ] **检查项 1.3:** 为一个**已结束**或**已终止**的合同，添加一笔**开始日期在合同最终有效日期之前，但结束日期在其之后**的替班记录 (部分重叠)。
  - **预期结果:** `substitute_management_fee` 字段被更新，其计费天数只包含**超出合同最终有效日期的部分**。

### 场景二：提前终止合同

- [ ] **检查项 2.1:** 找到一个包含“未来替班记录”（替班结束日期在今天之后）的有效合同，并将其**提前终止**（新的终止日期在替班结束日期之前）。
  - **预期结果:** 在终止合同时，系统自动为该笔“悬空”的替班记录计算管理费，并更新其 `substitute_management_fee` 字段。

- [ ] **检查项 2.2:** 验证检查项 2.1 中生成的费用是否正确。
  - **预期结果:** 计费天数应等于 `替班结束日期` - `合同新的终止日期`。

### 场景三：费用豁免（不应产生费用的场景）

- [ ] **检查项 3.1:** 为一个**正常生效中**的合同，添加一笔**完全在合同有效期内**的替班记录。
  - **预期结果:** `substitute_management_fee` 字段应为0或 `NULL`。

- [ ] **检查项 3.2:** 提前终止一个合同，但其名下所有的替班记录都在**新的终止日期之前**结束。
  - **预期结果:** 所有关联的替班记录的 `substitute_management_fee` 字段应为0或 `NULL`。

- [ ] **检查项 3.3:** 为一个**自动续签**且未终止的合同添加期外替班。
  - **预期结果:** `substitute_management_fee` 字段应为0或 `NULL`。

### 通用检查

- [ ] **检查项 4.1:** 检查替班账单的生成。
  - **预期结果:** 在 `BillingEngine` 生成替班账单时，`substitute_management_fee` 的金额被正确地加到账单的管理费部分。替班记录本身附加在“被替班”的账单中。

- [ ] **检查项 4.2:** 验证费用的计算标准。
  - **预期结果:** 费用的总金额与该替班人员的**级别**和预设的**每日管理费率**相匹配。

- [ ] **检查项 4.3:** 验证日期优先级。
  - **预期结果:** 在所有计算中，系统优先使用合同的 `termination_date`（终止日期），如果该日期不存在，才使用 `end_date`（结束日期）。