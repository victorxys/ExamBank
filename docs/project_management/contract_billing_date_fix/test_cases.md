# 测试用例：合同账单日期校准

### 测试用例 1: 合同变更（月中）

- **测试目的**: 验证在月中进行合同变更时，新旧合同的账单周期能完美衔接，无重叠、无遗漏。
- **涉及模块/文件**:
    - `frontend/src/components/ContractDetail.jsx` (变更弹窗)
    - `backend/api/contract_api.py` (假设的API入口)
    - `backend/services/contract_service.py` (假设的合同服务)
    - `backend/services/billing_engine.py` (账单引擎)
- **输入**:
    1.  **原合同 A**:
        - 周期: `2025-11-01` ~ `2025-11-30`
    2.  **变更操作**:
        - 在 `ContractDetail.jsx` 页面，点击“变更合同”。
        - 在弹窗中，选择“变更生效日期”为 `2025-11-16`。
        - 填写其他必要信息（如更换服务人员、价格等）。
        - 确认变更。
- **期望输出**:
    1.  **原合同 A 状态**:
        - `status` 变为 `terminated`。
        - `termination_date` 或等效的 `end_date` 被更新为 `2025-11-16`。
    2.  **新合同 B 创建**:
        - `start_date` 必须是 `2025-11-17`。
        - `end_date` 为用户在弹窗中选择的新结束日期。
    3.  **账单生成**:
        - **合同 A 的账单**: 最后一个（或更新后的）账单周期应为 `2025-11-01` ~ `2025-11-16`，计费天数 **16** 天。
        - **合同 B 的账单**: 第一个账单周期应为 `2025-11-17` ~ `2025-11-30` (或其他周期结束日)，计费天数 **14** 天 (针对11月份)。
    4.  **前端UI**:
        - “变更合同”弹窗中的日期选择器标签为“变更生效日期”。
        - 弹窗中有明确的提示文字，告知用户新合同将从次日开始。
- **实际输出 & 测试结果**:
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

---

### 测试用例 2: 合同续约（月底）

- **测试目的**: 验证在月底进行续约，跨月份时日期计算依然准确。
- **涉及模块/文件**:
    - `frontend/src/components/ContractDetail.jsx` (续约弹窗)
    - `backend/api/contract_api.py`
    - `backend/services/contract_service.py`
- **输入**:
    1.  **原合同 C**:
        - 周期: `2025-11-01` ~ `2025-11-30`
    2.  **续约操作**:
        - 在 `ContractDetail.jsx` 页面，点击“续约”。
        - 弹窗中应自动填充新合同开始日期为 `2025-12-01`。
        - 确认续约。
- **期望输出**:
    1.  **原合同 C 状态**: `status` 变为 `finished` 或 `renewed`。
    2.  **新合同 D 创建**:
        - `start_date` 必须是 `2025-12-01`。
    3.  **账单生成**:
        - **合同 C 的账单**: 最后一个账单周期应为 `2025-11-01` ~ `2025-11-30`。
        - **合同 D 的账单**: 第一个账单周期应从 `2025-12-01` 开始。
- **实际输出 & 测试结果**:
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

---

### 测试用例 3: 跨年变更

- **测试目的**: 验证在年底进行变更，跨年份时日期计算依然准确。
- **输入**:
    1.  **原合同 E**:
        - 周期: `2025-12-15` ~ `2026-01-14`
    2.  **变更操作**:
        - 选择“变更生效日期”为 `2025-12-31`。
        - 确认变更。
- **期望输出**:
    1.  **原合同 E 状态**: `termination_date` 更新为 `2025-12-31`。
    2.  **新合同 F 创建**: `start_date` 必须是 `2026-01-01`。
    3.  **账单生成**:
        - **合同 E 的账单**: 最后一个账单周期结束于 `2025-12-31`。
        - **合同 F 的账单**: 第一个账单周期开始于 `2026-01-01`。
- **实际输出 & 测试结果**:
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]
