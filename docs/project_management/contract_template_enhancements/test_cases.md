# 合同模板管理功能增强 - 测试用例

### 测试用例: 1. 列表视图显示

- **测试目的:** 验证合同模板列表页能正确、完整地显示所有必要信息。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateManager.jsx`, `backend/api/contract_template_api.py` (GET /api/contract_templates)
- **输入:**
    1. 数据库中有多个模板，包含不同名称、版本、类型。
    2. 至少有一个模板的 `updated_at` 不等于 `created_at`。
- **期望输出:**
    1. 页面以表格形式展示模板列表。
    2. 表格包含列：模板名称、版本号、合同类型、创建时间、最后更新时间。
    3. 所有模板都按默认排序（例如，按名称和版本）正确显示。
    4. 每行都包含“查看”、“编辑”、“对比”、“删除”按钮。
    5. “对比”按钮在 `version` 为1的模板行中应为禁用状态。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 2. 查看模板功能

- **测试目的:** 验证用户可以正常预览模板的渲染效果。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateManager.jsx`
- **输入:**
    1. 点击任意模板行的“查看”按钮。
    2. 模板的 `content` 字段包含有效的Markdown语法（如标题、列表、粗体）。
- **期望输出:**
    1. 弹出一个模态框。
    2. 模态框内正确显示渲染后的HTML内容，而不是Markdown源码。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 3. 编辑页面跳转与数据加载

- **测试目的:** 验证从列表页能成功跳转到独立的编辑页面并加载正确的模板数据。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateManager.jsx`, `frontend/src/components/ContractTemplateEditor.jsx`, `App.jsx` (路由)
- **输入:**
    1. 点击任意模板行的“编辑”按钮。
- **期望输出:**
    1. 页面URL变为 `/contract-templates/edit/<template_id>`。
    2. `ContractTemplateEditor` 组件被加载。
    3. 编辑器中的表单（名称、类型、内容等）正确填充了所选模板的数据。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 4. 编辑器双模式切换

- **测试目的:** 验证编辑器可以在“分屏”和“源码”模式间正常切换。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateEditor.jsx`
- **输入:**
    1. 在编辑页面，点击模式切换按钮。
- **期望输出:**
    1. 点击“源码”按钮，预览区域消失，源码输入框变大。
    2. 点击“分屏”按钮，页面恢复为左右分栏的布局（左源码，右预览）。
    3. 切换过程中，输入框中的内容不丢失。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 5. “覆盖保存”的禁用逻辑

- **测试目的:** 验证当模板被合同时，无法“覆盖保存”。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateEditor.jsx`, `backend/api/contract_template_api.py` (GET /is_in_use)
- **输入:**
    1. 场景一：编辑一个**已被合同使用**的模板。
    2. 场景二：编辑一个**未被使用**的模板。
- **期望输出:**
    1. 场景一：进入编辑页面后，“覆盖保存”按钮应为禁用状态，并有提示信息。
    2. 场景二：进入编辑页面后，“覆盖保存”按钮应为可用状态。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 6. “覆盖保存”功能

- **测试目的:** 验证“覆盖保存”能正确更新模板。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateEditor.jsx`, `backend/api/contract_template_api.py` (PUT /<id>)
- **输入:**
    1. 编辑一个未被使用的模板，修改其内容。
    2. 点击“覆盖保存”按钮。
- **期望输出:**
    1. 保存成功，页面跳转回列表页。
    2. 列表页中，该模板的“最后更新时间”已更新，版本号不变。
    3. 再次查看或编辑该模板，内容为已修改后的新内容。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 7. “另存为新版”功能

- **测试目的:** 验证“另存为新版”能正确创建新版本的模板。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateEditor.jsx`, `backend/api/contract_template_api.py` (POST /<id>/save_new_version)
- **输入:**
    1. 编辑任意一个模板，修改其内容。
    2. 点击“另存为新版”按钮。
- **期望输出:**
    1. 保存成功，页面跳转回列表页。
    2. 列表页中出现一条新的模板记录。
    3. 新记录的“模板名称”和“合同类型”与原模板相同，但“版本号”加1。
    4. 新记录的“创建时间”和“最后更新时间”为当前时间。
    5. 原模板记录保持不变。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]

### 测试用例: 8. 版本对比功能

- **测试目的:** 验证版本对比功能可以正确展示差异。
- **涉及模块/文件:** `frontend/src/components/ContractTemplateManager.jsx`, `backend/api/contract_template_api.py` (GET /<id>/diff)
- **输入:**
    1. 点击一个 `version > 1` 的模板行的“对比”按钮。
- **期望输出:**
    1. 弹出一个模态框。
    2. 模态框内并排或上下显示当前版本和上一版本的Markdown源码。
    3. 两个版本内容应与数据库中存储的一致。
- **实际输出 & 测试结果:**
    - 单元测试: [待填充]
    - 集成测试: [待填充]
    - **最终检查结果:** [待填充]
